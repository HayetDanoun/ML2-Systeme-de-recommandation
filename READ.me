# README â€” SystÃ¨me de Recommandation de Films (avec Docker & Streamlit)

Ce projet est un **systÃ¨me de recommandation de films** utilisant un pipeline de type RAG (Retrieval-Augmented Generation), sâ€™appuyant Ã  la fois sur FAISS et sur des modÃ¨les Transformers tels que DPR et SBERT (Sentence-Transformers). Lâ€™objectif est de proposer des suggestions de films sur la base dâ€™une description textuelle fournie par lâ€™utilisateur, avec la possibilitÃ© de collecter du feedback (like/dislike) et de rÃ©indexer dynamiquement lâ€™index vectoriel pour amÃ©liorer la pertinence des recommandations.


---

## ğŸ¯ 1. Objectifs du Projet

- **Recommandation de films** basÃ©e sur une **description textuelle** donnÃ©e par l'utilisateur.
- **Utilisation d'embeddings vectoriels** pour comparer la similaritÃ© des films.
- **Moteur de recherche FAISS** pour une rÃ©cupÃ©ration rapide des films similaires.
- **Apprentissage dynamique** Ã  partir des feedbacks utilisateur (ajustement des recommandations).
- **DÃ©ploiement simple avec Docker** et **Docker Compose**.

---

## ğŸ“‚ 2. Architecture des Fichiers

```
ML2/
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ app.py                    # Interface utilisateur (Streamlit)
â”‚   â”œâ”€â”€ feedback_analysis.py       # Gestion et analyse des feedbacks
â”‚   â”œâ”€â”€ feedback_handler.py        # Stockage des feedbacks utilisateur
â”‚   â”œâ”€â”€ recommendation.py          # Moteur de recommandation (DPR, SBERT, FAISS)
â”‚   â””â”€â”€ style.css                  # Fichier CSS pour personnaliser Streamlit
â”œâ”€â”€ data/
â”‚   â”œâ”€â”€ feedback.csv               # Fichier CSV stockant les feedbacks (likes/dislikes)
â”‚   â”œâ”€â”€ movies_metadata_clean.csv  # Dataset de films nettoyÃ©
â”‚   â””â”€â”€ my_custom_dataset/         # Dataset HuggingFace + index FAISS
â”‚       â”œâ”€â”€ data-00000-of-00001.arrow
â”‚       â”œâ”€â”€ dataset_info.json
â”‚       â”œâ”€â”€ embeddings
â”‚       â””â”€â”€ state.json
â”œâ”€â”€ docker/
â”‚   â”œâ”€â”€ docker-compose.yml         # Configuration Docker Compose
â”‚   â”œâ”€â”€ Dockerfile                 # Image Docker pour l'application
â”‚   â””â”€â”€ entrypoint.sh              # Script d'initialisation Docker
â”œâ”€â”€ images/
â”‚   â””â”€â”€ 22059000-non-image-disponible-icone-vectoriel.jpg  # Image par dÃ©faut pour les films sans poster
â”œâ”€â”€ recommendation.ipynb            # Notebook Jupyter pour tests et analyses
â”œâ”€â”€ requirements.txt                # Liste des dÃ©pendances Python
```

---

## ğŸ—ï¸ 3. Technologies UtilisÃ©es

### ğŸ” **Moteur de Recommandation**
- **DPR (Dense Passage Retrieval)** : Transforme un texte en un vecteur dense (~768 dimensions).
- **SBERT (Sentence-Transformers)** : SpÃ©cialisÃ© dans la similaritÃ© de phrases, utile pour capturer le sens dâ€™une requÃªte utilisateur.
- **FAISS (Facebook AI Similarity Search)** : Permet une recherche ultra-rapide sur des milliers de films.

### ğŸ“Š **Gestion des Feedbacks**
- **KeyBERT** : Extraction automatique de mots-clÃ©s Ã  partir des commentaires utilisateurs.
- **Ajustement des Embeddings** : Boost ou pÃ©nalisation des films selon les feedbacks (likes/dislikes).
- **RÃ©-indexation dynamique** : Reconstruction de lâ€™index FAISS aprÃ¨s prise en compte des feedbacks.

### ğŸŒ **Interface Utilisateur**
- **Streamlit** : Interface web simple et interactive pour saisir des descriptions et obtenir des recommandations.

### ğŸ³ **Conteneurisation**
- **Docker & Docker Compose** : Facilite le dÃ©ploiement sur n'importe quelle machine.

---

## ğŸš€ 4. Installation et DÃ©ploiement

### 4.1 PrÃ©requis

- **Python 3.9+**
- **Docker**
- **Docker Compose**

### 4.2 Installation Locale (Sans Docker)

1ï¸âƒ£ **Cloner le projet** :
```bash
git clone https://github.com/HayetDanoun/ML2-Systeme-de-recommandation.git
cd ML2-Systeme-de-recommandation
```
ou

```bash
git clone git@github.com:HayetDanoun/ML2-Systeme-de-recommandation.git
cd ML2-Systeme-de-recommandation
```



2ï¸âƒ£ **Installer les dÃ©pendances** :
```bash
pip install -r requirements.txt
```

3ï¸âƒ£ **Lancer lâ€™application Streamlit** :
```bash
streamlit run app/app.py
```

Lâ€™interface sera disponible sur **http://localhost:8501**.

---

### 4.3 Utilisation avec Docker

1ï¸âƒ£ **Construire lâ€™image Docker** :
```bash
docker build -t film-recommender -f docker/Dockerfile .
```

2ï¸âƒ£ **Lancer le container** :
```bash
docker run -p 8501:8501 film-recommender
```

Lâ€™interface sera disponible sur **http://localhost:8501**.

---

### 4.4 DÃ©ploiement avec Docker Compose

Docker Compose permet de **gÃ©rer plusieurs containers** si nÃ©cessaire (exemple : ajouter une base de donnÃ©es).  
Pour dÃ©marrer lâ€™application :

```bash
docker-compose -f docker/docker-compose.yml up --build
```

Puis accÃ©dez Ã  **http://localhost:8501**.

Pour arrÃªter lâ€™application :
```bash
docker-compose -f docker/docker-compose.yml down
```

---

## ğŸ› ï¸ 5. FonctionnalitÃ©s

- Saisir une **description** dâ€™un film souhaitÃ©.
- Recevoir une **liste de recommandations** de films correspondants.
- Liker / Disliker les recommandations et laisser un **commentaire**.
- **RÃ©-indexer** les donnÃ©es aprÃ¨s retour utilisateur pour amÃ©liorer les futures suggestions.

---

## ğŸ” 6. DÃ©tails Techniques

### 6.1 **CrÃ©ation des Embeddings**

1ï¸âƒ£ **PrÃ©traitement du dataset (`movies_metadata_clean.csv`)** :
   - Suppression des films sans description ou trop court.
   - Retrait des doublons.
   - Filtrage sur la langue (ex. original_language == "en").
   - Nettoyage (stopwords anglais, lemmatisation, mise en minuscules...).
   - CrÃ©ation dâ€™un champ `text` = `title + overview`.

2ï¸âƒ£ **Calcul des embeddings** avec **DPR** et **SBERT**.
   - DRP :  facebook/dpr-ctx_encoder-single-nq-base pour encoder la colonne text. On rÃ©cupÃ¨re pooler_output (taille ~768).
   - SBERT : sentence-transformers/all-mpnet-base-v2 pour produire un embedding ~768D.

3ï¸âƒ£ **Indexation avec FAISS** pour rechercher les films similaires.
   - Ajout dâ€™un index FAISS pour les colonnes embeddings (DPR) et embeddings_sbert (SBERT).
   - Sauvegarde du dataset HuggingFace et de lâ€™index dans my_custom_dataset.

---

## ğŸ”§ 7. SystÃ¨me de Recommandation (Streamlit + RAG)

### 7.1 Fonctionnement

1ï¸âƒ£ **Chargement dans recommendation.py** :
- `recommendation.py` charge le modÃ¨le **RagTokenForGeneration** et **RagRetriever** avec lâ€™index FAISS local.
- Lâ€™utilisateur saisit une description (ex. *"An action movie with superheroes and humor"*).
- La requÃªte est encodÃ©e, puis FAISS retrouve les vecteurs de films les plus proches.
- Les titres, overviews et chemins de poster des films les plus pertinents sont renvoyÃ©s.

2ï¸âƒ£ **Interface (app.py)** :
- L'utilisateur saisit une description de film et choisit le nombre de recommandations souhaitÃ©.
- En appuyant sur **"Obtenir des recommandations"**, FAISS recherche les films ayant les vecteurs les plus proches.
- Les films correspondants sont affichÃ©s avec leurs titres, overviews et affiches.
- **SystÃ¨me de feedback** :
  - L'utilisateur peut **liker** ou **disliker** chaque recommandation.
  - En cas de dislike, il peut entrer un commentaire expliquant son choix.
  - Les avis des utilisateurs (likes/dislikes + commentaires) sont enregistrÃ©s dans `data/feedback.csv`.

### 7.2 RÃ©-indexation dynamique
- **Extraction des mots-clÃ©s** des commentaires via **KeyBERT**.
- Un bouton **"Appliquer la rÃ©-indexation maintenant"** dÃ©clenche `adjust_embeddings_based_on_feedback()` :
  - Une rÃ©-indexation automatique est donc faites 
  - Les mots-clÃ©s des commentaires **nÃ©gatifs** pÃ©nalisent les embeddings des films correspondants (*multiplicateur < 1*).
  - Les mots-clÃ©s des commentaires **positifs** boostent les embeddings (*multiplicateur > 1*).
- Un nouvel index FAISS est alors reconstruit avec les embeddings ajustÃ©s.
- **Les recommandations sâ€™amÃ©liorent donc au fil du temps en tenant compte des prÃ©fÃ©rences rÃ©elles des utilisateurs.**


---

## ğŸ† 8. RÃ©sumÃ©

âœ” **Moteur de recommandation avancÃ©** basÃ© sur **DPR, SBERT et FAISS**.  
âœ” **Interface utilisateur Streamlit** simple et efficace.  
âœ” **Gestion dynamique des feedbacks**  pour amÃ©liorer les suggestions grÃ¢ce Ã  KeyBERT et l'ajustement des embeddings FAISS.
âœ” **DÃ©ploiement facilitÃ© avec Docker & Docker Compose**.  

---

ğŸš€ **Testez-le dÃ¨s maintenant et amÃ©liorez vos recommandations de films !**

